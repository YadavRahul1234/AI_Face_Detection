<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - AI Face Detection System</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f4f4f4;
      }
      h1 {
        text-align: center;
        color: #333;
      }
      .container {
        max-width: 1200px;
        margin: auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      .filters {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }
      input,
      button {
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      button {
        background-color: #007bff;
        color: white;
        border: none;
        cursor: pointer;
      }
      button:hover {
        background-color: #0056b3;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: center;
      }
      th {
        background-color: #f2f2f2;
      }
      .section {
        margin-bottom: 40px;
      }
      .form-group {
        margin-bottom: 10px;
      }
      @media (max-width: 768px) {
        .filters {
          flex-direction: column;
          align-items: center;
        }
        table {
          font-size: 14px;
        }
        th,
        td {
          padding: 6px;
        }
      }
    </style>
  </head>
  <body>
    <h1>üìä Admin Dashboard - AI Face Detection System</h1>
    <div style="text-align: center; margin-bottom: 20px">
      <button
        onclick="goBack()"
        style="
          padding: 10px 20px;
          background-color: #6c757d;
          color: white;
          border: none;
          border-radius: 5px;
          cursor: pointer;
        "
      >
        ‚¨ÖÔ∏è Back to Home
      </button>
    </div>
    <div class="container">
      <div class="section">
        <h2>Live Capture Records</h2>
        <div class="filters">
          <input
            type="text"
            id="nameFilter"
            placeholder="Filter by name"
            value="{{ name_filter }}"
          />
          <input type="date" id="dateFilter" value="{{ date_filter }}" />
          <button onclick="applyFilters()">Apply Filters</button>
          <button onclick="clearFilters()">Clear</button>
        </div>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Date</th>
              <th>Time</th>
            </tr>
          </thead>
          <tbody>
            {% for row in attendance %}
            <tr>
              <td>{{ row[0] }}</td>
              <td>{{ row[1] }}</td>
              <td>{{ row[2] }}</td>
              <td>{{ row[3] }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="section">
        <h2>Employee Management</h2>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for emp in employees %}
            <tr>
              <td>{{ emp[0] }}</td>
              <td>
                <input
                  type="text"
                  value="{{ emp[1] }}"
                  id="name-{{ emp[0] }}"
                />
              </td>
              <td>
                <button onclick="updateEmployee({{ emp[0] }})">Update</button>
                <button onclick="deleteEmployee({{ emp[0] }})">Delete</button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <script>
      function applyFilters() {
        const name = document.getElementById("nameFilter").value;
        const date = document.getElementById("dateFilter").value;
        const url = new URL(window.location);
        url.searchParams.set("name", name);
        url.searchParams.set("date", date);
        window.location.href = url;
      }

      function clearFilters() {
        window.location.href = "/admin_dashboard";
      }

      function goBack() {
        window.location.href = "/";
      }

      function updateEmployee(id) {
        const name = document.getElementById("name-" + id).value;
        fetch("/manage_employee", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: "action=update&id=" + id + "&name=" + encodeURIComponent(name),
        })
          .then(function (res) {
            return res.json();
          })
          .then(function (data) {
            alert(data.message);
            if (data.success) location.reload();
          });
      }

      function deleteEmployee(id) {
        if (confirm("Are you sure you want to delete this employee?")) {
          fetch("/manage_employee", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: "action=delete&id=" + id,
          })
            .then(function (res) {
              return res.json();
            })
            .then(function (data) {
              alert(data.message);
              if (data.success) location.reload();
            });
        }
      }
    </script>
  </body>
</html>
